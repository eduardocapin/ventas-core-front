<div class="autocomplete-wrapper" [class.dropdown-open]="dropdownOpen" #autocompleteWrapper>
  <div class="input-container-modern">
    <input #searchInput type="text" class="form-control-modern" [placeholder]="selectedValue ? '' : placeholder"
      [(ngModel)]="searchTerm" (input)="onInputChange()" (focus)="onDropdownOpen()" (keydown)="onInputKeyDown($event)"
      autocomplete="off" />

    <div class="actions-wrapper">
      <button class="action-btn clear-btn" type="button" (mousedown)="clearSelection($event)" *ngIf="selectedValue"
        title="Limpiar selección">
        <i class="bi bi-x-lg"></i>
      </button>
      <button class="action-btn toggle-btn" type="button" (mousedown)="toggleDropdown($event)" title="Ver opciones">
        <i class="bi bi-chevron-down"></i>
      </button>
    </div>
  </div>

  <!-- Panel de resultados -->
  <div class="autocomplete-results" [class.dropdown-up]="dropdownDirection === 'up'"
    [class.dropdown-down]="dropdownDirection === 'down'" [ngStyle]="container === 'body' ? dropdownStyles : {}"
    *ngIf="dropdownOpen && filteredOptions.length > 0">
    <div class="results-list" (scroll)="onScroll($event)">
      <div class="result-item" *ngFor="let option of displayedOptions; let i = index" (mousedown)="selectOption(option)"
        [class.active]="selectedValue?.id === option.id" [class.highlighted]="isHighlighted(i)">
        <span class="text-truncate">{{ option[displayField] || "Vacío" }}</span>
      </div>
    </div>
  </div>

  <!-- Sin resultados -->
  <div class="autocomplete-results" [class.dropdown-up]="dropdownDirection === 'up'"
    [class.dropdown-down]="dropdownDirection === 'down'" [ngStyle]="container === 'body' ? dropdownStyles : {}"
    *ngIf="dropdownOpen && filteredOptions.length === 0">
    <div class="no-results">
      <i class="bi bi-search me-2"></i> No se encontraron resultados
    </div>
  </div>
</div>